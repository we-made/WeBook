{% include "arrangement/vue/popover_component.html" %}

<template id="delete-location-dialog-template">
    <dialog-component :is-visible="isVisible" 
                      :use-backdrop="true"
                      @close="isVisible = false"
                      :is-draggable="true">
        <template v-slot:header>    
            <h4 class="mb-0" v-else>
                <i class="fas fa-exclamation text-danger"></i>&nbsp;
            </h4>
        </template>
    
        <template v-slot:content>
            
            <h1 class="text-center">
                <i class="fas fa-exclamation-triangle text-warning"></i>
            </h1>
            <h3 class="text-center">Er du sikker?</h3>

            <p class="text-center">
                Er du sikker på at du ønsker å slette denne lokasjonen?
                Rommene og tilhørende aktiviteter vil ikke bli slettet, men en kan ikke lenger booke rommene.
            </p>

            <span class="fw-bold text-center w-100">
                Skriv inn navnet på lokasjonen for å bekrefte slettingen:
            </span>
            <input type="text" name="" id="" class="form-control form-control-lg" v-model="roomNameInputVerify">

            <div v-if="isVerified" class=" text-center mt-2">
                <h3>
                    <i class="fas fa-check text-success"></i>
                </h3>
            </div>

        </template>
    
        <template v-slot:footer>
            <div class="d-flex justify-content-center align-items-center">
                <div>
                    <button class="btn wb-btn-secondary">
                        Avbryt
                    </button>
                    <button class="btn wb-btn-main" 
                        :disabled="!isVerified"
                        @click="deleteLocation()">

                        Slett lokasjon
                    </button>
                </div>
            </div>
        </template>
    </dialog-component>

</template>

<script>
    let DeleteLocationDialogComponent = {
        components: {
            DialogComponent
        },
        props: {
        },
        data() {
            return {
                roomNameInputVerify: null,
                isVisible: false,
                locationSlug: null,
                locationName: null,
            }
        },
        computed: {
            isVerified() {
                return this.roomNameInputVerify === this.locationName;
            }
        },
        methods: {
            open(locationName, locationSlug) {
                this.locationName = locationName;
                this.locationSlug = locationSlug;
                this.isVisible = true;
            },
            deleteLocation() {
                if (!this.isVerified) {
                    return;
                }

                fetch("/arrangement/location/json/delete/" + this.locationSlug + "/", {
                    method: "DELETE",
                    headers: {
                        "X-CSRFToken": "{{ csrf_token }}"
                    }
                }).then(response => {
                    if (response.status === 200) {
                        this.isVisible = false;
                        document.location.href = "/arrangement/location/list";
                    }
                });
            }
        },
        watch: {
        },
        mounted() {

        },
        template: "#delete-location-dialog-template",
        delimiters: ['[[', ']]']
    }
</script>