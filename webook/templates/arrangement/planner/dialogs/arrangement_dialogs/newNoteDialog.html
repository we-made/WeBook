<div id="newNoteDialog" title="Nytt notat">
    <div class='bg-white p-2 border border-1'>

        <textarea name="" class="form-control" id="newNoteDialog__content" cols="30" rows="10"
            placeholder="Tast inn..">
        </textarea>

        <div class="form-check">
            <input class="form-check-input" type="checkbox" value="" id="has_personal_info"/>
            <label class="form-check-label" for="flexCheckChecked">Inneholder personlig informasjon</label>
          </div>

        <button class="btn-block btn btn-success btn-sm" onclick="submitNote()" type="button">
            Lagre
        </button>
    </div>
</div>

<script>
    function submitNote() {
        let data = new FormData();
        data.append("entityPk", '{{arrangementPk}}');
        data.append("has_personal_information", $('#has_personal_info').is(':checked') ? 1 : 0)
        data.append("entityType", 'arrangement');
        data.append("content", $('#newNoteDialog__content').val());
        data.append('csrfmiddlewaretoken', "{{ csrf_token }}");

        fetch('{% url "arrangement:post_comment" %}', {
            method: 'POST',
            body: data,
            credentials: 'same-origin',
        }).then( _ => { 
            document.dispatchEvent(
                new CustomEvent("arrangementInspector.hasBeenUpdated", {'detail': {
                    dialog: "newNoteDialog",
                }})
            )
        });
    }
</script>