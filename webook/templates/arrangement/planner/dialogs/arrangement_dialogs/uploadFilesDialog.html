{% load static i18n %}


<div id="{{ dialog }}" title="{% trans 'Upload files' %}" class="bg-white">
    <form action="" enctype="application/x-www-form-urlencoded" id="uploadFilesDialogForm">
        <div class="file-upload-wrapper">
            <input type="file"
                id="input-file-now"
                name="file_field"
                class="file-upload-input"
                multiple="true"
                data-mdb-file-upload="file-upload" />
        </div>

        {% csrf_token %}

        <div class="clearfix mt-2">
            <div class="float-end">
                <a href="#" class="btn wb-btn-secondary btn-lg"
                    onclick="window.dialogApi.close('{{manager}}', '{{dialog}}')">
                    <i class="fas fa-times"></i>
                    Avbryt
                </a>
                <button class="btn btn-sm wb-btn-main shadow-0"
                    type="submit">
                    <i class="fa fa-upload"></i>
                    {% trans "Upload" %}
                </button>
            </div>

        </div>
    </form>
</div>

<script>
    $(document).ready(function () {
        const fileUploadEl = document.querySelector("#input-file-now");
        const fileUploadInstance = new FileUpload(fileUploadEl);

        $('#uploadFilesDialogForm').on('submit', function (e) {
            e.preventDefault();
            e.returnValue = false;

            let form = $('#uploadFilesDialogForm')[0];
            let formData = new FormData(form);
            
            document.dispatchEvent(
                new CustomEvent("{{manager}}.submit", { "detail": {
                    dialog: '{{dialog}}',
                    formData: formData,
                    csrf_token: '{% csrf_token %}',
                }})
            );
        });
    });
</script>