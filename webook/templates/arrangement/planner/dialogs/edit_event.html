{% load static i18n %}


<div class="modal" tabindex="-1" role="dialog" id="editEventDialog">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Edit event</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close" onclick="$('#editEventDialog').modal('hide')">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <input type="hidden" id="event_id" code-qualified-name="event_id" />

          <div class="form-group">
            <label>Tittel</label>
            <input type="text" class="form-control" id="title" code-qualified-name="title"/>
          </div>

          <label>Fra</label>
          <div class="row">
            <div class="col-6">
              <input type="date" class="form-control" id="fromDate" code-qualified-name="fromDate">
            </div>
            <div class="col-6">
              <input type="time" class="form-control" id="fromTime" code-qualified-name="fromTime">
            </div>
          </div>

          <label>Til</label>
          <div class="row">
            <div class="col-6">
              <input type="date" class="form-control" id="toDate" code-qualified-name="toDate">
            </div>
            <div class="col-6">
              <input type="time" class="form-control" id="toTime" code-qualified-name="toTime">
            </div>
          </div>

          <label>Farge</label>
          <input type="color" class="form-control" id="color" code-qualified-name="color">
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" onclick="$(eventEditDialog).modal('hide')">Avbryt</button>
          <button type="button" class="btn btn-primary" onclick="saveEvent()">{% trans "Save" %}</button>
        </div>
      </div>
    </div>
  </div>

<script>
    let eventEditDialog = document.getElementById('editEventDialog');

    $(document).ready(function () {
      new ColorSelectComponent("color_picker");
    })

    var eventDialogManager = new InputGroupManager(
        [
            document.getElementById('event_id'),
            document.getElementById('title'),
            document.getElementById('fromDate'),
            document.getElementById('fromTime'),
            document.getElementById('toTime'),
            document.getElementById('toDate'),
            document.getElementById('color'),
        ]
    )

    function newEventDialog() {
        eventDialogManager.flush();
        let eventEditDialog = document.getElementById('editEventDialog');
        eventDialogManager.event_id.value = -1;
        $(eventEditDialog).modal('show');
    }

    function updateEventDialog(event_uuid) {
        eventDialogManager.flush();
        console.log("Event Edit::>> " + event_uuid)
        let event = planner.local_context.events.get(event_uuid);
        // Write in existing values for this event
        eventDialogManager.event_id.value = event_uuid;
        eventDialogManager.title.value = event.title;
        eventDialogManager.fromDate.valueAsDate = event.from;
        eventDialogManager.fromTime.value = parseDateObjTimeToString(event.from);
        eventDialogManager.toDate.valueAsDate = event.to;
        eventDialogManager.toTime.value = parseDateObjTimeToString(event.to);
        eventDialogManager.color.value = event.color;

        $(eventEditDialog).modal('show');
    }

    function saveEvent() {
        let event_obj = {
            title: eventDialogManager.title.value,
            from: new Date(eventDialogManager.fromDate.value + "T" + eventDialogManager.fromTime.value),
            to: new Date(eventDialogManager.toDate.value + "T" + eventDialogManager.toTime.value),
            color: eventDialogManager.color.value,
        }

        console.log(event_obj)

        let toastrMessage = "";
        if (eventDialogManager.event_id.value !== "-1") {
          planner.local_context.update_event(event_obj, eventDialogManager.event_id.value);
          toastrMessage = "Hendelse oppdatert!";
        }
        else {
          planner.local_context.add_event(event_obj);
          toastrMessage = "Hendelse opprettet!"
        }

        $(eventEditDialog).modal('hide');
        toastr["success"](toastrMessage);
    }
</script>