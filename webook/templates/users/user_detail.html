{% extends "users/users_base.html" %}
{% load static %}
{% load static i18n %}
{% load custom_tags %}


{% block title %}User: {{ object.get_representative_name }}{% endblock %}

{% block inner %}

    {% if request.user|has_group:"planners" %}

    <div class="row">
        <div class="{% if user|has_group:'planners' %}col-lg-8 col-md-12 col-sm-12{% else %}col-12{% endif %}">

            <div class="p-3 border rounded-6 shadow-3 mt-2 pb-5">
                <div class="d-flex justify-content-center">
                    <div>
                        <h4 class="text-center"><i class="fas fa-calendar-alt"></i></h4>
                        <h4>
                            Agenda
                        </h4>
                    </div>
                </div>
                <div id="day_calendar"></div>
            </div>

        </div>
        {% if user|has_group:"planners" %}
            <div class="col-lg-4 col-md-12 col-sm-12">
                <div class="p-3 border rounded-6 shadow-3 mt-2">
                    <div class="d-flex justify-content-center">
                        <div>
                            <h4 class="text-center"><i class="fas fa-calendar-alt"></i></h4>
                            <h4>
                                Mine arrangementer
                            </h4>
                        </div>
                    </div>


                    {% if FUTURE_ARRANGEMENTS_RESPONSIBLE|length == 0 %}
                        <div class="alert alert-info">
                            Du har ingen fremtidige arrangementer. Arrangementer du er ansvarlig for vil vises her.
                        </div>
                    {% else %}

                        <div class="table-responsive">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Dato</th>
                                        <th>Status</th>
                                        <th>Navn</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for arrangement in FUTURE_ARRANGEMENTS_RESPONSIBLE %}
                                    <tr>
                                        <td>{{arrangement.start.start}} -- {{arrangement.end.end}}</td>
                                        <td>
                                            {% if arrangement.state.value == 2 %}
                                                <div class="badge badge-info">
                                                    Fremtidig
                                                </div>    
                                            {% elif arrangement.state.value == 0 %}
                                                <div class="badge badge-light">
                                                    Fortidig
                                                </div>
                                            {% elif arrangement.state.value == 1 %}
                                                <div class="badge badge-success">
                                                    Pågår
                                                </div>
                                            {% endif %}
                                        </td>
                                        <td>{{arrangement.name}}</td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    {% endif %}

                </div>
            </div>
        {% endif %}
    </div>

    {% else %}
        <div id="day_calendar"></div>
    {% endif %}

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            var calendarEl = document.getElementById('day_calendar');
            var calendar = new FullCalendar.Calendar(calendarEl, {
                schedulerLicenseKey: '{{ FULLCALENDAR_LICENSE_KEY }}',
                initialView: 'listDay',
                height: 600,
                navLinks:true,
                eventSources: [
                    {
                        events: async (times) => {
                            return await fetch(`{% url 'arrangement:my_events_event_source' %}?start=${times.start.toISOString().replace(".000Z", "")}&end=${times.end.toISOString().replace(".000Z", "")}`)
                                .then(response => response.json());
                        },
                    },
                ],
                locale: 'nb',
                headerToolbar: {
                    left: 'prev,next today',
                    center: 'title',
                    right: 'dayGridMonth,timeGridWeek,timeGridDay,listDay'
                } 
            });
            calendar.render();
          });
      </script>
{% endblock inner %}

